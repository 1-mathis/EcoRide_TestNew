# EcoRide ‚Äî Plateforme de covoiturage √©coresponsable

> **TP DWWM ‚Äî Projet complet front + back**  
> Objectif : concevoir, d√©velopper et d√©ployer une application web s√©curis√©e favorisant le covoiturage en voiture, avec une identit√© visuelle ¬´‚ÄØgreen‚ÄØ¬ª.  
> _NB : la conception **BDD relationnelle & NoSQL** sera r√©alis√©e dans une it√©ration d√©di√©e ‚Äî **ne pas utiliser le sch√©ma fourni en annexe**. Les sections ‚ÄúDonn√©es‚Äù de ce README sont donc pr√©par√©es pour accueillir notre **mod√®le maison** ult√©rieurement._

---

## üìö Sommaire
- [Vision & pitch](#-vision--pitch)
- [P√©rim√®tre fonctionnel (US1 ‚Üí US13)](#-p√©rim√®tre-fonctionnel-us1--us13)
- [Architecture & choix techniques](#-architecture--choix-techniques)
- [D√©marrage rapide (dev local)](#-d√©marrage-rapide-dev-local)
- [Qualit√©, s√©curit√© & conformit√©](#-qualit√©-s√©curit√©--conformit√©)
- [Conception donn√©es (placeholder)](#-conception-donn√©es-placeholder)
- [UX/UI & identit√©](#-uxui--identit√©)
- [D√©ploiement & CI/CD](#-d√©ploiement--cicd)
- [Plan de projet & Kanban](#-plan-de-projet--kanban)
- [Annexes (Mermaid)](#-annexes-mermaid)

---

## üåø Vision & pitch
**EcoRide** facilite le **covoiturage en voiture** en mettant l‚Äôaccent sur l‚Äô√©cologie, l‚Äô√©conomie et la simplicit√© d‚Äôusage. Les trajets **√©lectriques** sont mis en avant (badge ¬´‚ÄØ√©co‚ÄØ¬ª), les utilisateurs g√®rent leurs r√¥les (chauffeur / passager), leurs v√©hicules, leurs pr√©f√©rences, et participent aux trajets via un syst√®me de **cr√©dits**.

**Objectifs cl√©s**
- Exp√©rience claire pour **rechercher / filtrer / participer** √† des trajets.
- **Back-office** pour employ√©s (validation d‚Äôavis, incidents) et **administration** (comptes, graphiques, suspensions).
- **D√©ploiement** reproductible + **documentation** du setup local & cloud.

---

## üß≠ P√©rim√®tre fonctionnel (US1 ‚Üí US13)

| # | Titre | R√¥le principal | R√©sum√© |
|---:|---|---|---|
| US1 | Page d‚Äôaccueil | Visiteur | Pr√©sentation, barre de recherche, footer (contact + mentions l√©gales). |
| US2 | Menu | Visiteur | Acc√®s Accueil, Covoiturages, Connexion, Contact. |
| US3 | Vue des covoiturages | Visiteur | Formulaire (ville d√©part, arriv√©e, date). Affichage : conducteur (pseudo, photo, note), places restantes, prix, d√©part/arriv√©e, badge ¬´‚ÄØ√©co‚ÄØ¬ª, bouton ¬´‚ÄØd√©tail‚ÄØ¬ª. Proposition de **date la plus proche** s‚Äôil n‚Äôy a pas de r√©sultats. |
| US4 | Filtres | Visiteur | √âcologique (√©lectrique), prix max, dur√©e max, note minimale du conducteur. |
| US5 | D√©tail covoiturage | Visiteur/Utilisateur | D√©tail complet + **avis** conducteur, **v√©hicule** (marque, mod√®le, √©nergie), **pr√©f√©rences**. |
| US6 | Participer √† un covoiturage | Utilisateur | Bouton ¬´‚ÄØParticiper‚ÄØ¬ª si places & cr√©dits OK. **Double confirmation**. D√©cr√©ment places & cr√©dits, trace en ¬´‚ÄØespace passager‚ÄØ¬ª. Auth obligatoire si non connect√©. |
| US7 | Cr√©ation de compte | Visiteur | Pseudo, email, **mot de passe robuste**, **20 cr√©dits offerts**. |
| US8 | Espace Utilisateur | Utilisateur | Choix r√¥le(s). **Chauffeur** : plaque, 1√®re immat., marque, mod√®le, couleur, places, pr√©f√©rences (fumeur/animaux + custom). **Passager** : aucune donn√©e requise. |
| US9 | Saisir un voyage | Utilisateur (chauffeur) | D√©part, arriv√©e, **prix libre** (plateforme retient **2 cr√©dits**), association √† un v√©hicule existant ou nouveau. |
| US10 | Historique | Utilisateur | Historique chauffeur/passager, **annulation** avec mise √† jour places/cr√©dits, **mail** aux participants si annulation chauffeur. |
| US11 | D√©marrer/Arriver | Utilisateur | **D√©marrer** un trajet, puis **Arriv√©e √† destination**. Emails de confirmation aux passagers, **validation** et **cr√©dits chauffeur** si tout OK; sinon **signalement** pour employ√©. |
| US12 | Espace Employ√© | Employ√© | Valider/refuser **avis**; consulter **incidents** (trajets n√©gatifs) avec d√©tails. |
| US13 | Espace Admin | Admin | Cr√©er comptes employ√©s, **graph covoiturages/jour**, **graph revenus cr√©dits/jour**, total cr√©dits, **suspensions** (utilisateurs & employ√©s). |

> _Statut BDD :_ les comportements donn√©es (cr√©dits, avis, incidents, etc.) sont con√ßus mais **le sch√©ma relationnel/NoSQL sera d√©fini ult√©rieurement** dans une branche d√©di√©e.

---

## üîß Architecture & choix techniques

**Proposition de stack (√©volutive)**
- **Front** : Twig + CSS (Bootstrap/Tailwind au choix), JS vanilla + modules.
- **Back** : PHP 8.2+ (Symfony 7) ‚Äî Routing, Security, Mailer, Validator.
- **Relational DB (√† d√©finir)** : MySQL/MariaDB ou PostgreSQL.
- **NoSQL (√† d√©finir)** : MongoDB (journalisation avis/incidents/telemetry ou cache documents).
- **Auth** : Session + Password Hasher; r√¥les (`ROLE_USER`, `ROLE_EMPLOYE`, `ROLE_ADMIN`).
- **Mail** : SMTP/Mailtrap (dev), provider (prod).
- **Infra** : Docker (optionnel), d√©ploiement Fly.io / VPS.

### Diagramme de contexte
```mermaid
flowchart LR
  Visitor[Visiteur/Utilisateur] -- HTTP(S) --> WebApp[EcoRide Web (Symfony)]
  WebApp -- ORM --> SQL[(DB Relationnelle)]
  WebApp -- Driver --> NoSQL[(DB NoSQL)]
  WebApp -- SMTP --> Mail[Service Email]
  Admin[Admin/Employ√©] -- Back-Office --> WebApp
```

### Flux principal ¬´‚ÄØParticiper √† un covoiturage‚ÄØ¬ª (US6)
```mermaid
sequenceDiagram
  participant U as Utilisateur
  participant W as Web (Symfony)
  participant R as DB SQL
  participant M as Mailer

  U->>W: Cliquer ¬´ Participer ¬ª
  W->>R: V√©rifie places & cr√©dits
  R-->>W: OK / KO
  W->>U: Modale double confirmation
  U->>W: Confirme
  W->>R: D√©cr√©mente places & cr√©dits, enregistre participation
  W->>M: Notifications si besoin
  W-->>U: Succ√®s + r√©capitulatif
```

---

## ‚ñ∂Ô∏è D√©marrage rapide (dev local)

> _Pr√©-requis (Windows/macOS/Linux)_ : PHP 8.2+, Composer, Node.js (si Tailwind/Build), Symfony CLI (optionnel), un serveur SQL (MySQL/MariaDB/Postgres), et Mailtrap pour les emails de test.

```bash
# 1) Cloner le repo
git clone git@gitlab.com:mathisfer243/ecoride.git
cd ecoride

# 2) D√©pendances PHP + (optionnel) front
composer install
# npm ci && npm run dev   # si stack CSS/JS bundl√©e

# 3) Variables d'environnement
cp .env .env.local
# √âditer .env.local : DSN SQL, MAILER_DSN, APP_ENV=dev, etc.

# 4) Lancer le serveur de dev
# Option A : Symfony CLI
symfony server:start -d
# ou
symfony server:start
# Option B : PHP natif
php -S 127.0.0.1:8000 -t public

# 5) Acc√©der √† l'app
open http://127.0.0.1:8000
```

> **BDD :** non initialis√©e ici. Les commandes de cr√©ation/migrations/fixtures seront ajout√©es une fois le **mod√®le sur-mesure** valid√©.

---

## üõ°Ô∏è Qualit√©, s√©curit√© & conformit√©
- **S√©curit√© app** : mots de passe hash√©s, rate limiting sur endpoints sensibles, CSRF sur formulaires, validation serveur, RBAC par r√¥les.
- **S√©curit√© donn√©es** : s√©paration des secrets (`.env.local`), **principe du moindre privil√®ge** c√¥t√© DB, journaux audit√©s.
- **Qualit√©** : PHPStan, PHPCS, tests unitaires & fonctionnels (PHPUnit), CI (lint + analyse statique + tests).
- **RGPD** : mentions l√©gales & politique de confidentialit√©, consentement cookies si tracking, droit d‚Äôacc√®s/suppression.

---

## üß± Conception donn√©es (placeholder)
> Ces sections seront compl√©t√©es **apr√®s** validation de la strat√©gie donn√©es. Nous **n‚Äôutiliserons pas** le sch√©ma fourni en annexe.

- **Relationnel** (SQL) : utilisateurs, v√©hicules, trajets, participations, cr√©dits, avis, signalements/incidents, etc.
- **NoSQL** (Mongo) : √©v√©nements/telemetry, journaux d‚Äôavis & mod√©rations, cache de recherche.

**√Ä venir (branche `feat/db-design`)**
- `docs/sql/schema.sql` ‚Äî cr√©ation tables
- `docs/sql/seed.sql` ‚Äî donn√©es de d√©monstration
- `docs/er/er.mmd` ‚Äî (si besoin) diagramme Mermaid (er) ou class diagram

---

## üé® UX/UI & identit√©
- **Direction artistique** : palette ¬´‚ÄØ√©cologie‚ÄØ¬ª (verts, bleus doux, neutres), contraste AA/AAA.
- **Composants cl√©s** : barre de recherche, cartes trajets, badges √©co, modales confirmation, tableaux back-office, graphiques admin.

**Sitemap (simplifi√©)**
```mermaid
flowchart TD
  A[Accueil] --> B[Covoiturages]
  B --> C[Recherche]
  B --> D[Filtres]
  B --> E[D√©tail]
  A --> F[Connexion/Inscription]
  A --> G[Contact]
  H[Espace Utilisateur] --> I[Mes trajets]
  H --> J[Mes v√©hicules]
  K[Employ√©] --> L[Avis √† valider]
  K --> M[Incidents]
  N[Admin] --> O[Comptes employ√©s]
  N --> P[Graphiques]
  N --> Q[Suspensions]
```

---

## üöÄ D√©ploiement & CI/CD

**Cibles** : Fly.io ou VPS. Pipeline conseill√© : build ‚Üí tests ‚Üí d√©ploiement pr√©prod ‚Üí smoke tests ‚Üí d√©ploiement prod.

```mermaid
graph LR
  A[Push sur main/develop] --> B[CI Lint+Tests]
  B --> C{OK ?}
  C -- non --> D[Fail + rapport]
  C -- oui --> E[Build artefacts]
  E --> F[D√©ploiement Preprod]
  F --> G[Tests de fum√©e]
  G --> H{OK ?}
  H -- non --> D
  H -- oui --> I[D√©ploiement Prod]
```

**Variables √† pr√©voir (exemples)**
- `APP_ENV`, `APP_SECRET`, `DATABASE_URL`, `MONGODB_URL`, `MAILER_DSN`
- `PREPROD_*` vs `PROD_*` (h√¥tes, credentials, domaines)

---

## üó∫Ô∏è Plan de projet & Kanban

**Colonnes** : Backlog ‚Üí √Ä faire (Sprint) ‚Üí En cours ‚Üí En revue ‚Üí Fini (dev) ‚Üí Livr√© (main)

**User Story Map (extrait)**
```mermaid
flowchart LR
  subgraph Recherche & Parcours
    US1[Accueil]
    US2[Menu]
    US3[Vue trajets]
    US4[Filtres]
    US5[D√©tail]
    US6[Participer]
  end
  subgraph Comptes & R√¥les
    US7[Cr√©er compte]
    US8[Espace Utilisateur]
  end
  subgraph Offre Chauffeur
    US9[Saisir voyage]
    US10[Historique]
    US11[D√©marrer/Arriver]
  end
  subgraph Op√©rations
    US12[Employ√©]
    US13[Admin]
  end
```

**Roadmap (brouillon)**
```mermaid
gantt
  title Roadmap EcoRide (brouillon)
  dateFormat  YYYY-MM-DD
  section Setup
  Repo, CI de base           :done,    s1, 2025-09-16, 1d
  Base app + routing         :active,  s2, 2025-09-17, 3d
  section Core Visiteur
  Accueil/Menu/Recherche     :        v1, 2025-09-20, 5d
  Vue + Filtres + D√©tail     :        v2, after v1, 6d
  section Comptes
  Auth + 20 cr√©dits          :        c1, 2025-09-29, 3d
  Espace Utilisateur         :        c2, after c1, 4d
  section Chauffeur
  Saisie voyage              :        ch1, 2025-10-06, 4d
  Historique + Annulation    :        ch2, after ch1, 4d
  D√©marrer/Arriver + Emails  :        ch3, after ch2, 5d
  section Back-office
  Employ√© (avis/incidents)   :        bo1, 2025-10-23, 4d
  Admin (comptes/graphs)     :        bo2, after bo1, 5d
  section Donn√©es & D√©ploiement
  Conception BDD + NoSQL     :        db1, 2025-11-03, 6d
  D√©ploiements               :        dep, after db1, 4d
```

---

## üìé Annexes (Mermaid)

**Wireframe (tr√®s simplifi√© ‚Äî listage trajets)**
```mermaid
flowchart TD
  H[Header/Menu]
  S[Search Bar]
  F[Filtres lat√©raux]
  L[Liste cartes trajets]
  H --> S --> L
  S --> F
```

**Classes (brouillon minimal ‚Äî avant BDD)**
```mermaid
classDiagram
  class User {
    +id: UUID
    +username: string
    +email: string
    +roles: array
    +credit: int
  }
  class Vehicle {
    +id: UUID
    +brand: string
    +model: string
    +energy: string
    +seats: int
  }
  class CarSharing {
    +id: UUID
    +fromCity: string
    +toCity: string
    +dateTime: datetime
    +price: int
    +eco: bool
    +seatsLeft: int
  }
  User "1" -- "*" Vehicle : owns
  User "1" -- "*" CarSharing : drives
  User "*" -- "*" CarSharing : participates
```

---

## üìÑ Licence & cr√©dits
- Code : MIT (√† confirmer).
- Ic√¥nes, polices et images : v√©rifier licences (OSS/CC).

---

### Notes
- Ce README est con√ßu pour √©voluer : **sections BDD et scripts seront compl√©t√©s** une fois le mod√®le valid√©.
- La stack peut √™tre ajust√©e (Bootstrap ‚Üî Tailwind, MySQL ‚Üî Postgres, etc.) sans remettre en cause l‚Äôarchitecture g√©n√©rale.
